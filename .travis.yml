language: swift
osx_image: xcode11.3
xcode_destination: platform=iOS Simulator,OS=13.1,name=iPhone 11 Pro Max

env:
  global:
  - XCODE_DESTINATION='platform=iOS Simulator,OS=13.1,name=iPhone 11 Pro Max'
  - XCODE_WORKSPACE="Example/FTMobileCore.xcworkspace"

before_install:
 - pod --version
 - pod repo update --silent
 - pod install --project-directory='Example'
 - xcpretty --version
 - xcodebuild -version
 - xcodebuild -showsdks
 
script:
 - set -o pipefail && xcodebuild clean test build -enableCodeCoverage YES -workspace "Example/FTMobileCore.xcworkspace" -scheme FTMobileCore -destination 'platform=iOS Simulator,OS=13.1,name=iPhone 11 Pro Max' only_active_arch=YES defines_module=yes | xcpretty --report html
 - pod lib lint --allow-warnings

after_success:
  - bash <(curl -s https://codecov.io/bash)
  
before_deploy:
  - git config --local user.name "PraveenP"
  - git config --local user.email "ppraveentr@gmail.com"
  - sudo gem install cocoapods
      
deploy:
  provider: releases
  api_key: '${GITHUB_API_KEY}'
  skip_cleanup: true
  on:
    all_branches: true
    tags: true

deploy:
  provider: script
  script: ./scripts/cocoapod_push.sh
  on:
    all_branches: true
    tags: true
